{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://coorchat.dev/schemas/message-protocol/v1.0.json",
  "title": "CoorChat Message Protocol",
  "description": "JSON Schema for Multi-Agent Coordination System message format",
  "type": "object",
  "required": ["protocolVersion", "messageType", "senderId", "timestamp"],
  "properties": {
    "protocolVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Semantic version of the protocol (e.g., '1.0')",
      "examples": ["1.0", "1.1", "2.0"]
    },
    "messageType": {
      "type": "string",
      "enum": [
        "task_assigned",
        "task_started",
        "task_blocked",
        "task_progress",
        "task_completed",
        "task_failed",
        "capability_query",
        "capability_response",
        "status_query",
        "status_response",
        "error",
        "heartbeat",
        "agent_joined",
        "agent_left"
      ],
      "description": "Type of message being sent"
    },
    "senderId": {
      "type": "string",
      "format": "uuid",
      "description": "UUID of the sending agent"
    },
    "recipientId": {
      "type": "string",
      "format": "uuid",
      "description": "UUID of the recipient agent (null for broadcast)",
      "nullable": true
    },
    "taskId": {
      "type": "string",
      "format": "uuid",
      "description": "UUID of the associated task (if applicable)",
      "nullable": true
    },
    "priority": {
      "type": "integer",
      "minimum": 0,
      "maximum": 10,
      "default": 5,
      "description": "Message priority (0=lowest, 10=highest)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when message was created"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid",
      "description": "UUID for matching request/response pairs",
      "nullable": true
    },
    "payload": {
      "type": "object",
      "description": "Message-specific data (varies by messageType)",
      "additionalProperties": true
    },
    "deliveryStatus": {
      "type": "string",
      "enum": ["queued", "sending", "sent", "delivered", "acknowledged", "failed"],
      "default": "queued",
      "description": "Current delivery state of the message"
    }
  },
  "definitions": {
    "taskAssignedPayload": {
      "type": "object",
      "required": ["taskId", "description", "githubIssue"],
      "properties": {
        "taskId": { "type": "string", "format": "uuid" },
        "description": { "type": "string", "maxLength": 500 },
        "dependencies": {
          "type": "array",
          "items": { "type": "string", "format": "uuid" }
        },
        "githubIssue": { "type": "string", "format": "uri" }
      }
    },
    "taskProgressPayload": {
      "type": "object",
      "required": ["taskId", "percentComplete", "status"],
      "properties": {
        "taskId": { "type": "string", "format": "uuid" },
        "percentComplete": { "type": "integer", "minimum": 0, "maximum": 100 },
        "status": { "type": "string", "maxLength": 200 }
      }
    },
    "taskCompletedPayload": {
      "type": "object",
      "required": ["taskId", "result"],
      "properties": {
        "taskId": { "type": "string", "format": "uuid" },
        "result": { "type": "object" },
        "githubPR": { "type": "string", "format": "uri", "nullable": true }
      }
    },
    "taskFailedPayload": {
      "type": "object",
      "required": ["taskId", "error", "retryable"],
      "properties": {
        "taskId": { "type": "string", "format": "uuid" },
        "error": { "type": "string" },
        "retryable": { "type": "boolean" },
        "stackTrace": { "type": "string", "nullable": true }
      }
    },
    "capabilityResponsePayload": {
      "type": "object",
      "required": ["agentId", "roleType", "platform", "tools"],
      "properties": {
        "agentId": { "type": "string", "format": "uuid" },
        "roleType": { "type": "string" },
        "platform": { "type": "string" },
        "environmentType": { "type": "string" },
        "tools": { "type": "array", "items": { "type": "string" } },
        "languages": { "type": "array", "items": { "type": "string" } },
        "apiAccess": { "type": "array", "items": { "type": "string" } },
        "resourceLimits": { "$ref": "#/definitions/resourceLimits" }
      }
    },
    "resourceLimits": {
      "type": "object",
      "properties": {
        "apiQuotaPerHour": { "type": "integer", "minimum": 0 },
        "maxConcurrentTasks": { "type": "integer", "minimum": 1 },
        "rateLimitPerMinute": { "type": "integer", "minimum": 0 },
        "memoryLimitMB": { "type": "integer", "minimum": 0 }
      }
    },
    "errorPayload": {
      "type": "object",
      "required": ["code", "message"],
      "properties": {
        "code": { "type": "string" },
        "message": { "type": "string" },
        "details": { "type": "object", "nullable": true }
      }
    }
  },
  "examples": [
    {
      "protocolVersion": "1.0",
      "messageType": "task_assigned",
      "senderId": "550e8400-e29b-41d4-a716-446655440000",
      "recipientId": "6ba7b810-9dad-11d1-80b4-00c04fd430c8",
      "taskId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
      "priority": 7,
      "timestamp": "2026-02-14T10:30:00Z",
      "correlationId": "123e4567-e89b-12d3-a456-426614174000",
      "payload": {
        "taskId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
        "description": "Implement user authentication feature",
        "dependencies": [],
        "githubIssue": "https://github.com/org/repo/issues/42"
      },
      "deliveryStatus": "queued"
    }
  ]
}
